<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opportunities Feature - Implementation Plan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        h3 {
            color: #555;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h4 {
            color: #666;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .section {
            margin-bottom: 40px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .flow-box {
            background: #ecf0f1;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
        }
        .priority-high {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .priority-medium {
            background: #f39c12;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .priority-low {
            background: #95a5a6;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        ul, ol {
            margin-left: 30px;
            margin-top: 10px;
        }
        li {
            margin-bottom: 8px;
        }
        .enhancement {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
        }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .step {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ Opportunities Feature - Complete Implementation Plan</h1>
        
        <div class="section">
            <h2>1. Feature Overview</h2>
            <p><strong>Opportunities</strong> is a B2B marketplace feature where businesses can post their needs/requirements (leads) and service providers can submit proposals/offers. It works like a freelance platform but more corporate-focused.</p>
            
            <h3>Key Features:</h3>
            <ul>
                <li>âœ… Post opportunities/leads with detailed requirements</li>
                <li>âœ… Submit proposals/offers on opportunities</li>
                <li>âœ… Manage proposals (accept/reject/contact)</li>
                <li>âœ… Track applications and posted opportunities</li>
                <li>âœ… Rating system after completion</li>
                <li>âœ… Skills-based matching</li>
                <li>âœ… Save/bookmark opportunities</li>
                <li>âœ… Portfolio integration</li>
                <li>âœ… Auto-expiry for old opportunities</li>
                <li>âœ… Deadline reminders</li>
            </ul>
        </div>

        <div class="section">
            <h2>2. User Permissions & Limits</h2>
            <table>
                <tr>
                    <th>Action</th>
                    <th>Permission</th>
                    <th>Limit</th>
                </tr>
                <tr>
                    <td>Post Opportunity</td>
                    <td>Only users with role_id = 4</td>
                    <td>1 opportunity per 24 hours</td>
                </tr>
                <tr>
                    <td>Submit Proposal</td>
                    <td>All authenticated users</td>
                    <td>1 proposal per opportunity<br>3 proposals per 24 hours (across different opportunities)</td>
                </tr>
                <tr>
                    <td>View Opportunities</td>
                    <td>All authenticated users</td>
                    <td>No limit</td>
                </tr>
                <tr>
                    <td>Contact Proposer</td>
                    <td>Only opportunity owner</td>
                    <td>No limit</td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>3. Database Structure</h2>
            
            <h3>3.1. opportunities Table</h3>
            <table>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>id</td>
                    <td>bigint</td>
                    <td>Primary key</td>
                </tr>
                <tr>
                    <td>user_id</td>
                    <td>bigint (FK)</td>
                    <td>User who posted the opportunity</td>
                </tr>
                <tr>
                    <td>title</td>
                    <td>string</td>
                    <td>Opportunity title</td>
                </tr>
                <tr>
                    <td>description</td>
                    <td>text</td>
                    <td>Detailed description</td>
                </tr>
                <tr>
                    <td>category</td>
                    <td>enum</td>
                    <td>'looking_for_partner', 'need_consultant', 'project_work', 'fulltime_contract'</td>
                </tr>
                <tr>
                    <td>industry_id</td>
                    <td>bigint (FK, nullable)</td>
                    <td>Industry from industries table</td>
                </tr>
                <tr>
                    <td>budget_min</td>
                    <td>decimal(15,2)</td>
                    <td>Minimum budget</td>
                </tr>
                <tr>
                    <td>budget_max</td>
                    <td>decimal(15,2)</td>
                    <td>Maximum budget</td>
                </tr>
                <tr>
                    <td>budget_type</td>
                    <td>enum</td>
                    <td>'fixed', 'hourly', 'project', 'negotiable'</td>
                </tr>
                <tr>
                    <td>timeline</td>
                    <td>string</td>
                    <td>e.g., "2 weeks", "1 month", "3 months"</td>
                </tr>
                <tr>
                    <td>location</td>
                    <td>string (nullable)</td>
                    <td>Location preference</td>
                </tr>
                <tr>
                    <td>status</td>
                    <td>enum</td>
                    <td>'open', 'in_review', 'shortlisted', 'awarded', 'completed', 'closed'</td>
                </tr>
                <tr>
                    <td>deadline</td>
                    <td>timestamp (nullable)</td>
                    <td>Application deadline</td>
                </tr>
                <tr>
                    <td>required_skills</td>
                    <td>json</td>
                    <td>Array of required skills</td>
                </tr>
                <tr>
                    <td>preferred_experience</td>
                    <td>string (nullable)</td>
                    <td>Experience level preference</td>
                </tr>
                <tr>
                    <td>expires_at</td>
                    <td>timestamp (nullable)</td>
                    <td>Auto-expiry date (default: 30 days from creation)</td>
                </tr>
                <tr>
                    <td>views_count</td>
                    <td>unsigned integer</td>
                    <td>View counter</td>
                </tr>
                <tr>
                    <td>proposals_count</td>
                    <td>unsigned integer</td>
                    <td>Proposals counter</td>
                </tr>
                <tr>
                    <td>created_at</td>
                    <td>timestamp</td>
                    <td>Creation timestamp</td>
                </tr>
                <tr>
                    <td>updated_at</td>
                    <td>timestamp</td>
                    <td>Update timestamp</td>
                </tr>
                <tr>
                    <td>deleted_at</td>
                    <td>timestamp (nullable)</td>
                    <td>Soft delete</td>
                </tr>
            </table>

            <h3>3.2. opportunity_proposals Table</h3>
            <table>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>id</td>
                    <td>bigint</td>
                    <td>Primary key</td>
                </tr>
                <tr>
                    <td>opportunity_id</td>
                    <td>bigint (FK)</td>
                    <td>Opportunity reference</td>
                </tr>
                <tr>
                    <td>user_id</td>
                    <td>bigint (FK)</td>
                    <td>User who submitted proposal</td>
                </tr>
                <tr>
                    <td>proposal_text</td>
                    <td>text</td>
                    <td>Proposal description</td>
                </tr>
                <tr>
                    <td>proposed_budget</td>
                    <td>decimal(15,2) (nullable)</td>
                    <td>Proposed budget</td>
                </tr>
                <tr>
                    <td>estimated_timeline</td>
                    <td>string (nullable)</td>
                    <td>Estimated completion time</td>
                </tr>
                <tr>
                    <td>portfolio_items</td>
                    <td>json (nullable)</td>
                    <td>Array of portfolio links/items (can link to user's services/products)</td>
                </tr>
                <tr>
                    <td>status</td>
                    <td>enum</td>
                    <td>'pending', 'shortlisted', 'accepted', 'rejected', 'withdrawn'</td>
                </tr>
                <tr>
                    <td>submitted_at</td>
                    <td>timestamp</td>
                    <td>Submission timestamp</td>
                </tr>
                <tr>
                    <td>created_at</td>
                    <td>timestamp</td>
                    <td>Creation timestamp</td>
                </tr>
                <tr>
                    <td>updated_at</td>
                    <td>timestamp</td>
                    <td>Update timestamp</td>
                </tr>
            </table>
            <p><strong>Unique Constraint:</strong> (opportunity_id, user_id) - One proposal per user per opportunity</p>

            <h3>3.3. opportunity_ratings Table</h3>
            <table>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>id</td>
                    <td>bigint</td>
                    <td>Primary key</td>
                </tr>
                <tr>
                    <td>opportunity_id</td>
                    <td>bigint (FK)</td>
                    <td>Opportunity reference</td>
                </tr>
                <tr>
                    <td>rated_by_user_id</td>
                    <td>bigint (FK)</td>
                    <td>User who gave the rating</td>
                </tr>
                <tr>
                    <td>rated_user_id</td>
                    <td>bigint (FK)</td>
                    <td>User who received the rating</td>
                </tr>
                <tr>
                    <td>rating</td>
                    <td>tinyint</td>
                    <td>Rating 1-5 stars</td>
                </tr>
                <tr>
                    <td>comment</td>
                    <td>text (nullable)</td>
                    <td>Rating comment</td>
                </tr>
                <tr>
                    <td>created_at</td>
                    <td>timestamp</td>
                    <td>Creation timestamp</td>
                </tr>
                <tr>
                    <td>updated_at</td>
                    <td>timestamp</td>
                    <td>Update timestamp</td>
                </tr>
            </table>

            <h3>3.4. saved_opportunities Table</h3>
            <table>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>id</td>
                    <td>bigint</td>
                    <td>Primary key</td>
                </tr>
                <tr>
                    <td>user_id</td>
                    <td>bigint (FK)</td>
                    <td>User who saved the opportunity</td>
                </tr>
                <tr>
                    <td>opportunity_id</td>
                    <td>bigint (FK)</td>
                    <td>Saved opportunity</td>
                </tr>
                <tr>
                    <td>created_at</td>
                    <td>timestamp</td>
                    <td>Creation timestamp</td>
                </tr>
                <tr>
                    <td>updated_at</td>
                    <td>timestamp</td>
                    <td>Update timestamp</td>
                </tr>
            </table>
            <p><strong>Unique Constraint:</strong> (user_id, opportunity_id) - Prevent duplicate saves</p>
        </div>

        <div class="section">
            <h2>4. User Flows</h2>
            
            <h3>4.1. Flow: Post an Opportunity</h3>
            <div class="flow-box">
                <ol>
                    <li>User (role_id = 4) navigates to "Post Opportunity" page</li>
                    <li>System checks: Has user posted in last 24 hours? â†’ If yes, show error message</li>
                    <li>User fills form:
                        <ul>
                            <li>Title, Description</li>
                            <li>Category (Looking for Partner, Need Consultant, Project Work, Full-time Contract)</li>
                            <li>Industry (dropdown from industries table)</li>
                            <li>Budget (min, max, type: fixed/hourly/project/negotiable)</li>
                            <li>Timeline</li>
                            <li>Location (optional)</li>
                            <li>Required Skills (tags input)</li>
                            <li>Preferred Experience</li>
                            <li>Deadline (optional)</li>
                        </ul>
                    </li>
                    <li>System sets expires_at = created_at + 30 days (if not specified)</li>
                    <li>User submits form</li>
                    <li>Opportunity created with status = 'open'</li>
                    <li>User redirected to opportunity detail page</li>
                    <li>Notification sent to users with matching skills/industry (optional enhancement)</li>
                </ol>
            </div>

            <h3>4.2. Flow: Browse Opportunities</h3>
            <div class="flow-box">
                <ol>
                    <li>User navigates to "Opportunities" page</li>
                    <li>System shows list of open opportunities with filters:
                        <ul>
                            <li>Search by title/description</li>
                            <li>Filter by industry</li>
                            <li>Filter by category</li>
                            <li>Filter by budget range</li>
                            <li>Filter by location</li>
                            <li>Filter by skills</li>
                            <li>Sort by: newest, deadline, proposals count</li>
                        </ul>
                    </li>
                    <li>System shows skills-matched opportunities at top (if user has skills in profile)</li>
                    <li>User can click "Save" button to bookmark opportunity</li>
                    <li>User clicks on opportunity card to view details</li>
                </ol>
            </div>

            <h3>4.3. Flow: View Opportunity Details</h3>
            <div class="flow-box">
                <ol>
                    <li>User clicks on opportunity</li>
                    <li>System increments views_count</li>
                    <li>System displays:
                        <ul>
                            <li>Full opportunity details</li>
                            <li>Poster information</li>
                            <li>Budget (visible to all)</li>
                            <li>Required skills</li>
                            <li>Proposals count</li>
                            <li>Deadline countdown</li>
                        </ul>
                    </li>
                    <li>If user is owner:
                        <ul>
                            <li>Show "Edit" and "Delete" buttons</ul>
                            <li>Show "View Proposals" button</li>
                        </ul>
                    </li>
                    <li>If user is not owner:
                        <ul>
                            <li>Check if user already submitted proposal â†’ Show "View My Proposal" button</li>
                            <li>Check if user can submit (3 proposals in 24h limit) â†’ Show "Submit Proposal" button or error</li>
                            <li>Show "Save" button</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <h3>4.4. Flow: Submit Proposal</h3>
            <div class="flow-box">
                <ol>
                    <li>User clicks "Submit Proposal" on opportunity detail page</li>
                    <li>System checks:
                        <ul>
                            <li>User already submitted? â†’ Show error</li>
                            <li>User submitted 3 proposals in last 24 hours? â†’ Show error with countdown</li>
                            <li>Opportunity still open? â†’ Show error if closed</li>
                        </ul>
                    </li>
                    <li>User fills proposal form:
                        <ul>
                            <li>Proposal text (required)</li>
                            <li>Proposed budget (optional)</li>
                            <li>Estimated timeline (optional)</li>
                            <li>Portfolio items:
                                <ul>
                                    <li>Link to existing services (dropdown)</li>
                                    <li>Link to existing products (dropdown)</li>
                                    <li>Or add custom portfolio links</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>User submits</li>
                    <li>Proposal created with status = 'pending'</li>
                    <li>Opportunity proposals_count incremented</li>
                    <li>Notification sent to opportunity owner</li>
                    <li>User redirected to "My Applications" page</li>
                </ol>
            </div>

            <h3>4.5. Flow: Manage Proposals (Opportunity Owner)</h3>
            <div class="flow-box">
                <ol>
                    <li>Owner navigates to "My Opportunities" â†’ Selects opportunity â†’ "View Proposals"</li>
                    <li>System shows list of all proposals with:
                        <ul>
                            <li>Proposer name and profile</li>
                            <li>Proposal text</li>
                            <li>Proposed budget</li>
                            <li>Timeline</li>
                            <li>Portfolio items (clickable links)</li>
                            <li>Status badge</li>
                            <li>Submitted date</li>
                        </ul>
                    </li>
                    <li>Owner can:
                        <ul>
                            <li>Click "Shortlist" â†’ Status changes to 'shortlisted' â†’ Notification sent to proposer</li>
                            <li>Click "Accept" â†’ Status changes to 'accepted' â†’ Opportunity status changes to 'awarded' â†’ Notification sent to proposer</li>
                            <li>Click "Reject" â†’ Status changes to 'rejected' â†’ Notification sent to proposer</li>
                            <li>Click "Contact" â†’ Opens chat with proposer (using existing chat system)</li>
                        </ul>
                    </li>
                    <li>Owner can filter proposals by status (pending, shortlisted, accepted, rejected)</li>
                </ol>
            </div>

            <h3>4.6. Flow: View My Applications</h3>
            <div class="flow-box">
                <ol>
                    <li>User navigates to "My Applications" (from dashboard)</li>
                    <li>System shows list of user's submitted proposals with:
                        <ul>
                            <li>Opportunity title (link to detail)</li>
                            <li>Status badge (pending, shortlisted, accepted, rejected)</li>
                            <li>Submitted date</li>
                            <li>Actions: "View Proposal", "Withdraw" (if pending)</li>
                        </ul>
                    </li>
                    <li>User can filter by status</li>
                    <li>User clicks "Withdraw" â†’ Proposal status changes to 'withdrawn' â†’ Notification sent to owner</li>
                </ol>
            </div>

            <h3>4.7. Flow: Rate After Completion</h3>
            <div class="flow-box">
                <ol>
                    <li>Opportunity owner marks opportunity as 'completed'</li>
                    <li>System shows rating form to owner:
                        <ul>
                            <li>Rate the accepted proposer (1-5 stars)</li>
                            <li>Add comment (optional)</li>
                        </ul>
                    </li>
                    <li>Owner submits rating</li>
                    <li>Rating saved in opportunity_ratings table</li>
                    <li>Proposer's average rating updated (if we track this in users table)</li>
                    <li>Rating displayed on proposer's profile</li>
                </ol>
            </div>

            <h3>4.8. Flow: Skills Matching</h3>
            <div class="flow-box">
                <ol>
                    <li>User has skills in profile (from services/products or user profile)</li>
                    <li>When browsing opportunities, system:
                        <ul>
                            <li>Extracts user's skills from profile/services/products</li>
                            <li>Matches against opportunity required_skills</li>
                            <li>Shows matched opportunities at top with "Recommended for you" badge</li>
                            <li>Shows match percentage (e.g., "80% match")</li>
                        </ul>
                    </li>
                    <li>User can also see "Opportunities matching your skills" section in dashboard</li>
                </ol>
            </div>

            <h3>4.9. Flow: Auto-Expiry</h3>
            <div class="flow-box">
                <ol>
                    <li>System runs daily cron job (or queue job)</li>
                    <li>Checks all opportunities where:
                        <ul>
                            <li>expires_at < now()</li>
                            <li>status = 'open' or 'in_review'</li>
                        </ul>
                    </li>
                    <li>Updates status to 'closed'</li>
                    <li>Sends notification to owner: "Your opportunity has expired"</li>
                    <li>Sends notification to all pending proposers: "Opportunity you applied to has closed"</li>
                </ol>
            </div>

            <h3>4.10. Flow: Deadline Reminders</h3>
            <div class="flow-box">
                <ol>
                    <li>System runs daily cron job</li>
                    <li>Checks opportunities with deadline in next 3 days</li>
                    <li>Sends notification to owner: "Your opportunity deadline is approaching"</li>
                    <li>Sends notification to proposers: "Opportunity you applied to has deadline soon"</li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>5. Models & Relationships</h2>
            
            <h3>5.1. Opportunity Model</h3>
            <div class="code-block">
Relationships:
- belongsTo(User) â†’ poster
- belongsTo(Industry) â†’ industry
- hasMany(OpportunityProposal) â†’ proposals
- hasMany(OpportunityRating) â†’ ratings
- belongsToMany(User, 'saved_opportunities') â†’ users who saved

Scopes:
- open() â†’ status = 'open'
- inReview() â†’ status = 'in_review'
- shortlisted() â†’ status = 'shortlisted'
- awarded() â†’ status = 'awarded'
- completed() â†’ status = 'completed'
- closed() â†’ status = 'closed'
- active() â†’ status in ['open', 'in_review', 'shortlisted']
- expired() â†’ expires_at < now()
- byIndustry($industryId)
- byCategory($category)

Methods:
- incrementViews()
- incrementProposals()
- canBeEditedBy($userId)
- isExpired()
- daysUntilExpiry()
            </div>

            <h3>5.2. OpportunityProposal Model</h3>
            <div class="code-block">
Relationships:
- belongsTo(Opportunity) â†’ opportunity
- belongsTo(User) â†’ proposer

Scopes:
- pending() â†’ status = 'pending'
- shortlisted() â†’ status = 'shortlisted'
- accepted() â†’ status = 'accepted'
- rejected() â†’ status = 'rejected'

Methods:
- shortlist()
- accept()
- reject()
- withdraw()
            </div>

            <h3>5.3. OpportunityRating Model</h3>
            <div class="code-block">
Relationships:
- belongsTo(Opportunity)
- belongsTo(User, 'rated_by_user_id') â†’ rater
- belongsTo(User, 'rated_user_id') â†’ rated user
            </div>

            <h3>5.4. SavedOpportunity Model</h3>
            <div class="code-block">
Relationships:
- belongsTo(User)
- belongsTo(Opportunity)
            </div>
        </div>

        <div class="section">
            <h2>6. Services & Business Logic</h2>
            
            <h3>6.1. OpportunityService</h3>
            <div class="code-block">
Methods:

1. canUserPostOpportunity($userId)
   - Check if user posted in last 24 hours
   - Return: ['allowed' => bool, 'message' => string, 'next_post_at' => timestamp]

2. canUserSubmitProposal($userId, $opportunityId)
   - Check if already submitted for this opportunity
   - Check if submitted 3 proposals in last 24 hours
   - Return: ['allowed' => bool, 'message' => string, 'next_submit_at' => timestamp]

3. getSkillsMatchedOpportunities($userId, $limit = 10)
   - Extract user skills from profile/services/products
   - Match against opportunities required_skills
   - Return opportunities sorted by match percentage

4. getUserSkills($userId)
   - Extract skills from:
     * User profile (if skills field exists)
     * User's services (categories, tags)
     * User's products (categories, tags)
   - Return array of unique skills

5. calculateMatchPercentage($userSkills, $opportunitySkills)
   - Calculate percentage of matching skills
   - Return: 0-100

6. autoExpireOpportunities()
   - Find expired opportunities
   - Update status to 'closed'
   - Send notifications
   - Return count of expired opportunities

7. sendDeadlineReminders()
   - Find opportunities with deadline in next 3 days
   - Send notifications to owners and proposers
   - Return count of reminders sent
            </div>
        </div>

        <div class="section">
            <h2>7. Controllers</h2>
            
            <h3>7.1. Web Controllers</h3>
            <h4>OpportunityController</h4>
            <ul>
                <li><strong>index()</strong> - Browse opportunities with filters, skills matching</li>
                <li><strong>create()</strong> - Show create form</li>
                <li><strong>store()</strong> - Validate, check limits, create opportunity</li>
                <li><strong>show($id)</strong> - View details, increment views</li>
                <li><strong>edit($id)</strong> - Show edit form (only owner)</li>
                <li><strong>update($id)</strong> - Update (only owner, if open)</li>
                <li><strong>destroy($id)</strong> - Soft delete (only owner)</li>
                <li><strong>myOpportunities()</strong> - User's posted opportunities</li>
                <li><strong>proposals($id)</strong> - View proposals for opportunity (only owner)</li>
                <li><strong>save($id)</strong> - Save/bookmark opportunity</li>
                <li><strong>unsave($id)</strong> - Remove bookmark</li>
                <li><strong>saved()</strong> - List saved opportunities</li>
                <li><strong>complete($id)</strong> - Mark as completed (only owner)</li>
            </ul>

            <h4>OpportunityProposalController</h4>
            <ul>
                <li><strong>store()</strong> - Submit proposal, check limits</li>
                <li><strong>accept($id)</strong> - Accept proposal (only owner)</li>
                <li><strong>reject($id)</strong> - Reject proposal (only owner)</li>
                <li><strong>shortlist($id)</strong> - Shortlist proposal (only owner)</li>
                <li><strong>withdraw($id)</strong> - Withdraw own proposal</li>
                <li><strong>myApplications()</strong> - User's submitted proposals</li>
            </ul>

            <h4>OpportunityRatingController</h4>
            <ul>
                <li><strong>store()</strong> - Submit rating after completion</li>
            </ul>

            <h3>7.2. API Controllers</h3>
            <p>Same methods as web controllers, but return JSON responses instead of views.</p>
            <ul>
                <li>API/OpportunityController</li>
                <li>API/OpportunityProposalController</li>
                <li>API/OpportunityRatingController</li>
            </ul>
        </div>

        <div class="section">
            <h2>8. Views (Blade Templates)</h2>
            
            <h3>8.1. Browse Opportunities</h3>
            <p><strong>File:</strong> resources/views/opportunities/index.blade.php</p>
            <ul>
                <li>Search bar</li>
                <li>Filter sidebar: Industry, Category, Budget, Location, Skills</li>
                <li>Sort options: Newest, Deadline, Proposals</li>
                <li>Opportunity cards grid/list view</li>
                <li>Each card shows: Title, Category badge, Industry, Budget range, Timeline, Skills tags, Proposals count, "Recommended" badge (if matched), Save button</li>
                <li>Pagination</li>
            </ul>

            <h3>8.2. Create/Edit Opportunity</h3>
            <p><strong>Files:</strong> resources/views/opportunities/create.blade.php, edit.blade.php</p>
            <ul>
                <li>Form fields: Title, Description, Category, Industry, Budget (min/max/type), Timeline, Location, Required Skills (tags input), Preferred Experience, Deadline</li>
                <li>Validation messages</li>
                <li>24-hour limit warning (if applicable)</li>
            </ul>

            <h3>8.3. Opportunity Detail</h3>
            <p><strong>File:</strong> resources/views/opportunities/show.blade.php</p>
            <ul>
                <li>Full opportunity details</li>
                <li>Poster profile card</li>
                <li>Budget, Timeline, Location, Skills, Experience</li>
                <li>Deadline countdown</li>
                <li>Actions: Submit Proposal, Save, Edit (if owner), Delete (if owner), View Proposals (if owner)</li>
                <li>Related opportunities section</li>
            </ul>

            <h3>8.4. My Opportunities</h3>
            <p><strong>File:</strong> resources/views/opportunities/my-opportunities.blade.php</p>
            <ul>
                <li>List of user's opportunities</li>
                <li>Status badges, Proposals count, Views count</li>
                <li>Actions: View, Edit, Close, View Proposals</li>
                <li>Filter by status</li>
                <li>Stats: Total posted, Active, Proposals received</li>
            </ul>

            <h3>8.5. My Applications</h3>
            <p><strong>File:</strong> resources/views/opportunities/my-applications.blade.php</p>
            <ul>
                <li>List of user's submitted proposals</li>
                <li>Status badges (pending, shortlisted, accepted, rejected)</li>
                <li>Opportunity title (link), Submitted date</li>
                <li>Actions: View Proposal, Withdraw (if pending)</li>
                <li>Filter by status</li>
            </ul>

            <h3>8.6. Proposals Management</h3>
            <p><strong>File:</strong> resources/views/opportunities/proposals.blade.php</p>
            <ul>
                <li>List of proposals for an opportunity</li>
                <li>Each proposal card: Proposer profile, Proposal text, Budget, Timeline, Portfolio items, Status, Submitted date</li>
                <li>Actions: Shortlist, Accept, Reject, Contact (opens chat)</li>
                <li>Filter by status</li>
                <li>Sort options</li>
            </ul>

            <h3>8.7. Saved Opportunities</h3>
            <p><strong>File:</strong> resources/views/opportunities/saved.blade.php</p>
            <ul>
                <li>List of saved/bookmarked opportunities</li>
                <li>Same card layout as browse page</li>
                <li>Unsave button</li>
            </ul>

            <h3>8.8. Submit Proposal Form</h3>
            <p><strong>File:</strong> resources/views/opportunities/submit-proposal.blade.php</p>
            <ul>
                <li>Modal or separate page</li>
                <li>Form fields: Proposal text, Proposed budget, Estimated timeline</li>
                <li>Portfolio section:
                    <ul>
                        <li>Link to existing services (dropdown with search)</li>
                        <li>Link to existing products (dropdown with search)</li>
                        <li>Add custom portfolio links (URL, title)</li>
                    </ul>
                </li>
                <li>Validation messages</li>
                <li>24-hour limit warning (if applicable)</li>
            </ul>
        </div>

        <div class="section">
            <h2>9. Routes</h2>
            
            <h3>9.1. Web Routes</h3>
            <div class="code-block">
// Opportunities
Route::get('/opportunities', [OpportunityController::class, 'index'])->name('opportunities.index');
Route::get('/opportunities/create', [OpportunityController::class, 'create'])->name('opportunities.create');
Route::post('/opportunities', [OpportunityController::class, 'store'])->name('opportunities.store');
Route::get('/opportunities/{id}', [OpportunityController::class, 'show'])->name('opportunities.show');
Route::get('/opportunities/{id}/edit', [OpportunityController::class, 'edit'])->name('opportunities.edit');
Route::put('/opportunities/{id}', [OpportunityController::class, 'update'])->name('opportunities.update');
Route::delete('/opportunities/{id}', [OpportunityController::class, 'destroy'])->name('opportunities.destroy');
Route::get('/my-opportunities', [OpportunityController::class, 'myOpportunities'])->name('opportunities.my');
Route::get('/opportunities/{id}/proposals', [OpportunityController::class, 'proposals'])->name('opportunities.proposals');
Route::post('/opportunities/{id}/save', [OpportunityController::class, 'save'])->name('opportunities.save');
Route::delete('/opportunities/{id}/unsave', [OpportunityController::class, 'unsave'])->name('opportunities.unsave');
Route::get('/saved-opportunities', [OpportunityController::class, 'saved'])->name('opportunities.saved');
Route::post('/opportunities/{id}/complete', [OpportunityController::class, 'complete'])->name('opportunities.complete');

// Proposals
Route::post('/opportunities/{id}/propose', [OpportunityProposalController::class, 'store'])->name('proposals.store');
Route::post('/proposals/{id}/accept', [OpportunityProposalController::class, 'accept'])->name('proposals.accept');
Route::post('/proposals/{id}/reject', [OpportunityProposalController::class, 'reject'])->name('proposals.reject');
Route::post('/proposals/{id}/shortlist', [OpportunityProposalController::class, 'shortlist'])->name('proposals.shortlist');
Route::post('/proposals/{id}/withdraw', [OpportunityProposalController::class, 'withdraw'])->name('proposals.withdraw');
Route::get('/my-applications', [OpportunityProposalController::class, 'myApplications'])->name('proposals.my');

// Ratings
Route::post('/opportunities/{id}/rate', [OpportunityRatingController::class, 'store'])->name('opportunities.rate');
            </div>

            <h3>9.2. API Routes</h3>
            <div class="code-block">
Route::prefix('opportunities')->group(function () {
    Route::get('/', [API\OpportunityController::class, 'index']);
    Route::post('/', [API\OpportunityController::class, 'store']);
    Route::get('/{id}', [API\OpportunityController::class, 'show']);
    Route::put('/{id}', [API\OpportunityController::class, 'update']);
    Route::delete('/{id}', [API\OpportunityController::class, 'destroy']);
    Route::get('/my/opportunities', [API\OpportunityController::class, 'myOpportunities']);
    Route::post('/{id}/save', [API\OpportunityController::class, 'save']);
    Route::delete('/{id}/unsave', [API\OpportunityController::class, 'unsave']);
    Route::get('/saved/list', [API\OpportunityController::class, 'saved']);
    Route::post('/{id}/complete', [API\OpportunityController::class, 'complete']);
    
    Route::post('/{id}/propose', [API\OpportunityProposalController::class, 'store']);
    Route::get('/{id}/proposals', [API\OpportunityProposalController::class, 'index']);
    Route::post('/proposals/{id}/accept', [API\OpportunityProposalController::class, 'accept']);
    Route::post('/proposals/{id}/reject', [API\OpportunityProposalController::class, 'reject']);
    Route::post('/proposals/{id}/shortlist', [API\OpportunityProposalController::class, 'shortlist']);
    Route::post('/proposals/{id}/withdraw', [API\OpportunityProposalController::class, 'withdraw']);
    Route::get('/my/applications', [API\OpportunityProposalController::class, 'myApplications']);
    
    Route::post('/{id}/rate', [API\OpportunityRatingController::class, 'store']);
});
            </div>
        </div>

        <div class="section">
            <h2>10. Chat Integration</h2>
            <p>When opportunity owner clicks "Contact Proposer":</p>
            <ul>
                <li>Use existing <code>ChatController::createConversation()</code> or <code>sendMessage()</code></li>
                <li>Create conversation between owner and proposer</li>
                <li>Redirect to chat/inbox page</li>
                <li>Or open chat modal if available</li>
                <li>Pre-fill message: "Hi, I'm interested in your proposal for [Opportunity Title]"</li>
            </ul>
        </div>

        <div class="section">
            <h2>11. Notifications</h2>
            <p>Using existing <code>NotificationService</code>, send notifications for:</p>
            <table>
                <tr>
                    <th>Event</th>
                    <th>Recipient</th>
                    <th>Type</th>
                </tr>
                <tr>
                    <td>New proposal submitted</td>
                    <td>Opportunity owner</td>
                    <td>opportunity_new_proposal</td>
                </tr>
                <tr>
                    <td>Proposal shortlisted</td>
                    <td>Proposer</td>
                    <td>proposal_shortlisted</td>
                </tr>
                <tr>
                    <td>Proposal accepted</td>
                    <td>Proposer</td>
                    <td>proposal_accepted</td>
                </tr>
                <tr>
                    <td>Proposal rejected</td>
                    <td>Proposer</td>
                    <td>proposal_rejected</td>
                </tr>
                <tr>
                    <td>Proposal withdrawn</td>
                    <td>Opportunity owner</td>
                    <td>proposal_withdrawn</td>
                </tr>
                <tr>
                    <td>Opportunity expired</td>
                    <td>Owner + All proposers</td>
                    <td>opportunity_expired</td>
                </tr>
                <tr>
                    <td>Deadline approaching (3 days)</td>
                    <td>Owner + Proposers</td>
                    <td>opportunity_deadline_reminder</td>
                </tr>
                <tr>
                    <td>New opportunity in your industry</td>
                    <td>Users with matching industry</td>
                    <td>opportunity_new_in_industry</td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>12. Dashboard Integration</h2>
            <p>Add to user dashboard:</p>
            <ul>
                <li><strong>"My Opportunities"</strong> section
                    <ul>
                        <li>Link to /my-opportunities</li>
                        <li>Quick stats: Active opportunities count, Total proposals received</li>
                    </ul>
                </li>
                <li><strong>"My Applications"</strong> section
                    <ul>
                        <li>Link to /my-applications</li>
                        <li>Quick stats: Pending proposals, Shortlisted count</li>
                    </ul>
                </li>
                <li><strong>"Recommended Opportunities"</strong> section
                    <ul>
                        <li>Shows top 5 skills-matched opportunities</li>
                        <li>Link to full list</li>
                    </ul>
                </li>
                <li><strong>"Saved Opportunities"</strong> section
                    <ul>
                        <li>Shows recently saved opportunities</li>
                        <li>Link to /saved-opportunities</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2>13. Scheduled Jobs (Cron)</h2>
            <p>Add to <code>app/Console/Kernel.php</code>:</p>
            <div class="code-block">
// Daily at 2 AM
$schedule->call(function () {
    app(OpportunityService::class)->autoExpireOpportunities();
    app(OpportunityService::class)->sendDeadlineReminders();
})->dailyAt('02:00');
            </div>
        </div>

        <div class="section">
            <h2>14. API Documentation</h2>
            <p>Update <code>resources/views/api-doc/index.blade.php</code>:</p>
            <ul>
                <li>Add new section: "Opportunities"</li>
                <li>Document all endpoints with:
                    <ul>
                        <li>Method (GET, POST, PUT, DELETE)</li>
                        <li>URL</li>
                        <li>Parameters</li>
                        <li>Request body (for POST/PUT)</li>
                        <li>Response format</li>
                        <li>Example requests/responses</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="section">
            <h2>15. Implementation Order</h2>
            <div class="step">
                <h3>Phase 1: Database & Models</h3>
                <ol>
                    <li>Create migrations (opportunities, proposals, ratings, saved_opportunities)</li>
                    <li>Run migrations</li>
                    <li>Create Eloquent models with relationships</li>
                    <li>Add relationships to User model</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 2: Business Logic</h3>
                <ol>
                    <li>Create OpportunityService</li>
                    <li>Implement 24-hour limit checks</li>
                    <li>Implement skills matching logic</li>
                    <li>Implement auto-expiry logic</li>
                    <li>Implement deadline reminder logic</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 3: Web Controllers</h3>
                <ol>
                    <li>Create OpportunityController (CRUD + dashboard methods)</li>
                    <li>Create OpportunityProposalController</li>
                    <li>Create OpportunityRatingController</li>
                    <li>Add role_id = 4 check for posting</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 4: Web Views</h3>
                <ol>
                    <li>Create browse opportunities page (with filters, skills matching)</li>
                    <li>Create create/edit opportunity forms</li>
                    <li>Create opportunity detail page</li>
                    <li>Create my-opportunities page</li>
                    <li>Create my-applications page</li>
                    <li>Create proposals management page</li>
                    <li>Create saved opportunities page</li>
                    <li>Create submit proposal form (with portfolio integration)</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 5: Routes & Navigation</h3>
                <ol>
                    <li>Add web routes</li>
                    <li>Add navigation links in header/dashboard</li>
                    <li>Add "Post Opportunity" button (visible only to role_id = 4)</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 6: API Controllers</h3>
                <ol>
                    <li>Create API/OpportunityController</li>
                    <li>Create API/OpportunityProposalController</li>
                    <li>Create API/OpportunityRatingController</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 7: API Routes</h3>
                <ol>
                    <li>Add API routes</li>
                    <li>Test API endpoints</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 8: Integrations</h3>
                <ol>
                    <li>Integrate chat system (contact proposer)</li>
                    <li>Add notification triggers</li>
                    <li>Add dashboard sections</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 9: Scheduled Jobs</h3>
                <ol>
                    <li>Add cron job for auto-expiry</li>
                    <li>Add cron job for deadline reminders</li>
                    <li>Test scheduled jobs</li>
                </ol>
            </div>

            <div class="step">
                <h3>Phase 10: Documentation & Testing</h3>
                <ol>
                    <li>Update API documentation</li>
                    <li>Test all user flows</li>
                    <li>Test limits and validations</li>
                    <li>Test notifications</li>
                    <li>Test skills matching</li>
                    <li>Test portfolio integration</li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>16. Testing Checklist</h2>
            <ul>
                <li>âœ… Post opportunity (role_id = 4 only)</li>
                <li>âœ… 24-hour posting limit enforcement</li>
                <li>âœ… Browse opportunities with filters</li>
                <li>âœ… Skills matching works correctly</li>
                <li>âœ… Submit proposal</li>
                <li>âœ… One proposal per opportunity limit</li>
                <li>âœ… 3 proposals per 24 hours limit</li>
                <li>âœ… View proposals (owner only)</li>
                <li>âœ… Accept/reject/shortlist proposals</li>
                <li>âœ… Contact proposer (opens chat)</li>
                <li>âœ… Save/unsave opportunities</li>
                <li>âœ… Portfolio integration (link services/products)</li>
                <li>âœ… Auto-expiry (cron job)</li>
                <li>âœ… Deadline reminders (cron job)</li>
                <li>âœ… Rating system</li>
                <li>âœ… Notifications sent correctly</li>
                <li>âœ… Dashboard sections display correctly</li>
            </ul>
        </div>

        <div class="section">
            <h2>17. Future Enhancements (Optional)</h2>
            <ul>
                <li>Milestone/payment system with escrow</li>
                <li>Advanced analytics for opportunity owners</li>
                <li>Proposal templates</li>
                <li>Bulk actions for proposals</li>
                <li>Industry-specific custom fields</li>
                <li>Social sharing of opportunities</li>
                <li>Email notifications in addition to in-app</li>
                <li>Opportunity search by skills (advanced)</li>
            </ul>
        </div>

        <div class="note">
            <h3>ðŸ“ Notes:</h3>
            <ul>
                <li>All budget amounts are visible to all users (as per requirement)</li>
                <li>No contact preference field (removed as per requirement)</li>
                <li>Only opportunity owner can contact proposers</li>
                <li>Skills matching uses user's services/products categories and any skills field in profile</li>
                <li>Portfolio integration allows linking to existing services/products or adding custom links</li>
                <li>Auto-expiry runs daily and closes opportunities after 30 days (or custom expires_at)</li>
                <li>Deadline reminders sent 3 days before deadline</li>
            </ul>
        </div>

        <div style="margin-top: 50px; padding: 20px; background: #f0f0f0; border-radius: 5px;">
            <h2 style="color: #2c3e50; margin-top: 0;">Ready for Approval</h2>
            <p>This plan includes all core features plus enhancements. Please review and approve before implementation begins.</p>
        </div>
    </div>
</body>
</html>
